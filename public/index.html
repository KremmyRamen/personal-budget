<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Budget</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="main.css">
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            width: 960px;
            height: 500px;
            position: relative;
        }

        .d3js-chart {
            margin-top: 20px;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<!-- A11y Change: Added a skip link for better accessibility -->
<a href="#main" class="skip">Skip to content</a>

<!-- A11y Change: Added role and aria-current attributes for better accessibility -->
<nav role="navigation">
    <ul>
        <li><a href="/" aria-current="page">Home</a></li>
        <li><a href="/about.html">About</a></li>
        <li><a href="/login.html">Login</a></li>
        <!-- SEO Change: Added "noopener" attribute for security on external links -->
        <li><a href="https://google.com" rel="external noopener">Google</a></li>
    </ul>
</nav>

<div class="hero">
    <!-- Semantic HTML Change: Changed <header> to <div> for styling purposes -->
    <div class="header-container">
        <header>
            <!-- Semantic HTML Change: Changed <h1> to <div> for styling purposes -->
            <div class="left-header">
                <h1>Personal Budget</h1>
            </div>
            <div class="right-header">
                <h2>A personal-budget management app</h2>
            </div>
        </header>
    </div>
</div>

<!-- A11y Change: Added role attribute for better accessibility -->
<main class="center" id="main" role="main">
    <div class="page-area">
        <div class="left-column">
            <!-- Content in the left column remains unchanged -->
        </div>

        <div class="right-column">
            <article>
                <header>
                    <!-- Semantic HTML Change: Changed <h1> to <header> for the article heading -->
                    <header>
                        <h1>Chart</h1>
                    </header>
                </header>
                <p>
                    <!-- A11y Change: Added alt text for better accessibility -->
                    <canvas id="myChart" width="400" height="400" alt="Chart depicting budget distribution"></canvas>
                </p>
            </article>

            <!-- D3.js Chart -->
            <section class="d3js-chart">
                <header>
                    <!-- Semantic HTML Change: Changed <h2> to <header> for a subheading -->
                    <header>
                        <h2>D3.js Chart</h2>
                    </header>
                </header>
                <svg id="d3jsChart" width="400" height="400" aria-label="D3.js Chart depicting budget distribution"></svg>
            </section>
        </div>
    </div>
</main>

<!-- A11y Change: Added role attribute for better accessibility -->
<footer class="bottom" role="contentinfo">
    <div class="center">
        All rights reserved &copy; Fabio Nolasco
    </div>
</footer>

<!-- Additional Chart.js, D3.js, and Axios scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>

<script>
    // Load data from the server
    axios.get('http://localhost:3000/budget')
        .then(response => {
            const budgetData = response.data.myBudget;

            // Chart.js initialization
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: budgetData.map(item => item.title),
                    datasets: [{
                        data: budgetData.map(item => item.budget),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(255, 205, 86, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // D3.js initialization
            const svg = d3.select('#d3jsChart');
            const width = +svg.attr('width');
            const height = +svg.attr('height');
            const radius = Math.min(width, height) / 2;

            const pie = d3.pie()
                .sort(null)
                .value(d => d.budget);

            const arc = d3.arc()
                .innerRadius(0)
                .outerRadius(radius);

            const color = d3.scaleOrdinal()
                .domain(budgetData.map(d => d.title))
                .range(d3.schemeCategory10);

            const arcs = svg.selectAll('arc')
                .data(pie(budgetData))
                .enter()
                .append('g')
                .attr('class', 'arc')
                .attr('transform', `translate(${width / 2},${height / 2})`);

            arcs.append('path')
                .attr('d', arc)
                .attr('fill', d => color(d.data.title));

            // Legend
            const legend = svg.selectAll('.legend')
                .data(color.domain())
                .enter()
                .append('g')
                .attr('class', 'legend')
                .attr('transform', (d, i) => `translate(0,${i * 20})`);

            legend.append('rect')
                .attr('x', width - 18)
                .attr('width', 18)
                .attr('height', 18)
                .style('fill', color);

            legend.append('text')
                .attr('x', width - 24)
                .attr('y', 9)
                .attr('dy', '.35em')
                .style('text-anchor', 'end')
                .text(d => d);
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
</script>

</body>
</html>
